<!DOCTYPE html>
<html>

<head>
    <title>Список кейсов</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.9, maximum-scale=1.0, user-scalable=no">
    <meta property='og:image' content='https://vlados776.github.io/OpenCase_Beta2/images/BigLogo.png'>
    <meta property='og:title' content='Open Case Simulator'>
    <meta property='og:description' content='Открывай кейсы, создавай кейсы, собери инвентарь!'>
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../css/main.css">
    <link rel="stylesheet" type="text/css" href="../css/rarity.css">
    <link rel="stylesheet" type="text/css" href="../css/fonts.css">
    <link rel="stylesheet" type="text/css" href="../css/animate.css">
    <link rel="stylesheet" href="../css/lobibox.min.css" />
    <link rel="stylesheet" type="text/css" href="../css/winter.css">
    
    <script src="../scripts/build/libs.js"></script>
    <script src="../scripts/bootstrap.min.js"></script>
    <script src="../scripts/main.js"></script>
    <script src="../scripts/localization.js"></script>
    <script src="../scripts/settings.js"></script>
    <script src="../scripts/skinNames.js"></script>
    <script src="../scripts/cases2.js"></script>
    <script src="../scripts/weapons.js"></script>
    <script src="../scripts/prices.js"></script>
    <script src="../scripts/quality.js"></script>
    <script src="../scripts/openCase.js"></script>
    <script src="../scripts/navigationMenu.js"></script>
    <script src="../scripts/news.js"></script>
    
    <link rel="stylesheet" href="../css/navigationMenu.css">
    <style>
        body {
            margin: 1px;
        }
        #container {
            position: relative;
        }
        .news {
            text-align: center;
            color: #fff;
            font-size: 1.1em;
            font-weight: bolder;
            max-height: 80px;
            overflow: hidden;
            position: relative;
            transition-duration: 0.5s;
        }
        .news-closed:before {
            background-image: linear-gradient(transparent 8%, #000 100%);
            content: '';
            width: 100%;
            position: absolute;
            height: 20px;
            bottom: 0;
            left: 0;
        }
        .news-overflow {
            position: absolute;
            bottom: -5px;
            background: #151515;
            padding: 3px 10px;
            border-radius: 5px;
            border: 1px solid #656565;
            cursor: pointer;
            margin-left: -30px;
            font-size: 12px;
            font-weight: normal;
            left: 0;
            right: 0;
            width: 70px;
            margin: auto;
        }
        .center-pills { display: inline-block; }
    </style>
</head>

<body data-localization="cases" data-inventory="no-load">
    <div class="site-overlay"></div>
    <div id="container" style="background-position: 0 39px;">
        <div class="navigationBar"></div>
        <span class='js-secretField' style='display: none'></span>
        
        <div class='news well well-sm'> 
           <div class="container" data-loc='news'>
               <p>Open menu to see missions</p>
            <p><a href="open.html?graffitiId=1">Community Graffiti Box 1</a>.
            <p><a href="open.html?graffitiId=0">Graffiti</a>! You can use them in chat.</p>
            </div>
        </div>
        
        <div class="container text-center">
            <ul class="nav nav-pills center-pills">
                <li class='active'><a href="#cases" data-toggle='tab' data-loc='cases'>Cases</a></li>
                <li><a href="#graffiti" data-toggle='tab' data-loc='graffiti'>Graffiti</a></li>
                <li><a href="#capsules" data-toggle='tab' data-loc='capsules'>Capsules</a></li>
            </ul>
        </div>
        
        <div class='tab-content clearfix'>
            <div class="cases tab-pane active" id='cases'>
                <div id="Default" class="casesBlock opened">
                    <h1 data-loc="cases">Кейсы</h1></div>
                <div id="eSports" class="casesBlock closed">
                    <h1 data-loc="esports">eSports</h1></div>
                <div id="Collection" class="casesBlock closed">
                    <h1 data-loc="collections">Коллекции</h1></div>
                <div id="Souvenir" class="casesBlock closed">
                    <h1 data-loc="souvenir">Сувенирные коллекции</h1></div>
                <div id="Workshop" class="casesBlock closed">
                    <h1 data-loc="workshop">Мастерская</h1></div>
                <div id="Special" class="casesBlock closed">
                    <h1 data-loc="special">Особые</h1></div>
            </div>
            
            <div class="cases tab-pane" id="graffiti">
                <div id="Graffiti_box_default" class="casesBlock closed">
                    <h1 data-loc="graffiti" >Graffiti</h1></div>
            </div>

            <div class="capsules tab-pane" id='capsules'>
                <div id="Capsules_default" class="casesBlock">
                    <h1 data-loc='capsules'>Capsules</h1>
                </div>
                <div id="Capsules_tournament" class="casesBlock">
                    <h1 data-loc='tournament stickers'>Tournament Stickers</h1>
                </div>
                <div id="Capsules_autograph" class="casesBlock">
                    <h1 data-loc='autograph stickers'>Autograph Capsule</h1>
                </div>
            </div>
        </div>
        
        <div id="modal-rank" class="modal fade" role="dialog" data-loc-group='special_popup'>
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        <p data-loc='low_level'>Only players with level <i></i> and higher can open this case.</p>
                    </div>
                    <div class="modal-footer">
                        <a href="faq.html#js-local-question-rank" class="btn btn-primary" data-loc='lvl_up'>How to level up?</a>
                        <button class="btn btn-default" data-dismiss="modal">OK</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="modal-knives" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        <div id='knives'></div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-default" data-dismiss="modal">OK</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="modal-special" class="modal fade" role="dialog" data-loc-group='special_popup'>
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        <p data-loc='need_more_cases'>To open a special case you need to open <i>${1}</i> more cases.<br>Or watch the ads.</p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-success" id="showVideoAd" data-loc='ad_button'>Watch the ads</button>
                        <button class="btn btn-default" data-dismiss="modal">OK</button>
                    </div>
                </div>
            </div>
        </div>
        
        <script id="caseTemplate">
            <div class='${caseType}{{if collection}} collection{{/if}}{{if addDate != null && Date.now() - Date.parse(addDate) < 72800000000}} new{{/if}}' data-case-id="${caseId}" data-souvenir='${souvenir}'>
                {{if deadline}}
                    <span class='countdown' data-deadline='${deadline}'></span>
                {{/if}}
                <img class='case-card' src='../images/Cases/casecard2.png'>
                {{if minLvl}}
                    <span class="case-min_lvl">${minLvl}</span>
                {{/if}}
                <img class='case-img' src='../images/Cases/cases/${img}'>
                <span class='case-price currency dollar'>${price}</span>
                <span class='case-name{{if specialClass}} ${specialClass}{{/if}}'>${name}</span>
            </div>
        </script>
        
        <script>
            $(function () {
                for (var i = 0; i < cases.length; i++) {
                    var specialClass = (typeof cases[i].specialClass == "undefined") ? "" : cases[i].specialClass;
                    var collection = (cases[i].type == "Souvenir") ? "souvenir" : (cases[i].type == "Collection") ? "collection" : "";
                    var casePrice = cases[i].price ? (cases[i].price / 100).toFixed(2) : getCasePrice(i);
                    if (Player.doubleBalance < parseFloat(casePrice) * 100 || (cases[i].minLvl && cases[i].minLvl > Level.calcLvl())) {
                        collection += ' disabled';
                    }
                    if (typeof cases[i].show != 'undefined' && cases[i].show === false) continue;
                    if (cases[i].deadline) {
                        var t = getTimeRemaining(cases[i].deadline);
                        if (t.total < 0) continue;
                    }
                    var cas = {
                        caseType: 'case',
                        collection: collection,
                        caseId: i,
                        souvenir: false,
                        deadline: cases[i].deadline,
                        minLvl: cases[i].minLvl,
                        img: cases[i].img,
                        price: casePrice,
                        specialClass: specialClass,
                        name: cases[i].name,
                        addDate: cases[i].addDate
                    }
                    var $curCase = $('#caseTemplate').tmpl(cas);
                    switch (cases[i].type) {
                    case "Default":
                        $("#Default").append($curCase);
                        break;
                    case "eSports":
                        $("#eSports").append($curCase);
                        break;
                    case "Special":
                        $("#Special").append($curCase);
                        break;
                    case "Collection":
                        $("#Collection").append($curCase);
                        break;
                    case "Workshop":
                        $("#Workshop").append($curCase);
                        break;
                    }
                    if (typeof cases[i].canBeSouvenir != 'undefined' && cases[i].canBeSouvenir == true) {
                        $curCaseSouv = $curCase.clone();
                        casePrice = cases[i].price ? (cases[i].price / 100).toFixed(2) : getCasePrice(i, true);
                        $("#Souvenir").append($curCaseSouv);
                        $curCaseSouv.data('souvenir', true);
                        if (Player.doubleBalance < parseFloat(casePrice) * 100) {
                            $curCaseSouv.addClass('disabled');
                        }
                        $curCaseSouv.find('.case-price').text(casePrice);
                    }
                }
                for (var i = 0; i < CAPSULES.length; i++) {
                    var specialClass = (typeof CAPSULES[i].specialClass == "undefined") ? "" : CAPSULES[i].specialClass;
                    var casePrice = cases[i].price ? (cases[i].price / 100).toFixed(2) : getCapsulePrice(i);
                    var cas = {
                        caseType: 'capsule',
                        collection: null,
                        caseId: i,
                        souvenir: false,
                        deadline: CAPSULES[i].deadline,
                        minLvl: CAPSULES[i].minLvl,
                        img: CAPSULES[i].img,
                        price: casePrice,
                        name: CAPSULES[i].name,
                        addDate: CAPSULES[i].addDate
                    }
                    var curCase = $('#caseTemplate').tmpl(cas);
                    if (typeof CAPSULES[i].show != 'undefined' && CAPSULES[i].show === false) continue;
                    if (CAPSULES[i].deadline) {
                        var t = getTimeRemaining(CAPSULES[i].deadline);
                        if (t.total < 0) continue;
                    }
                    switch (CAPSULES[i].type) {
                    case "Default":
                        $("#Capsules_default").append(curCase);
                        break;
                    case "Tournament":
                        $('#Capsules_tournament').append(curCase);
                        break;
                    case "Autograph":
                        $('#Capsules_autograph').append(curCase);
                        break;
                    case "Workshop":
                        $("#Capsules_workshop").append(curCase);
                        break;
                    }
                }
                for (var i = 0; i < GRAFFITI_BOX.length; i++) {
                    var specialClass = (typeof GRAFFITI_BOX[i].specialClass == "undefined") ? "" : GRAFFITI_BOX[i].specialClass;
                    var casePrice = GRAFFITI_BOX[i].price ? (GRAFFITI_BOX[i].price / 100).toFixed(2) : getGraffitiBoxPrice(i);
                    
                    /*
                    var curCase = "<div class='graffiti_box' data-case-id=" + i + " data-souvenir='false'>\
                        " + (GRAFFITI_BOX[i].deadline ? "<span class='countdown' data-deadline='" + GRAFFITI_BOX[i].deadline + "'></span>" : "") + "\
                        " + (GRAFFITI_BOX[i].minLvl ? '<span class="case-min_lvl">' + GRAFFITI_BOX[i].minLvl + '</span>' : '') + "\
                        <img class='case-img' src='../images/Cases/cases/" + GRAFFITI_BOX[i].img + "'>\
                        <span class='case-price currency dollar'>" + casePrice + "</span>\
                        <span class='case-name " + specialClass + "'>" + GRAFFITI_BOX[i].name + "</span>\
                    </div>";
                    */
                    var cas = {
                        caseType: 'graffiti_box',
                        specialClass: specialClass,
                        collection: null,
                        caseId: i,
                        souvenir: false,
                        deadline: GRAFFITI_BOX[i].deadline,
                        minLvl: GRAFFITI_BOX[i].minLvl,
                        img: GRAFFITI_BOX[i].img,
                        price: casePrice,
                        name: GRAFFITI_BOX[i].name,
                        addDate: GRAFFITI_BOX[i].addDate
                    }
                    var curCase = $('#caseTemplate').tmpl(cas);
                    if (typeof GRAFFITI_BOX[i].show != 'undefined' && GRAFFITI_BOX[i].show === false) continue;
                    if (GRAFFITI_BOX[i].deadline) {
                        var t = getTimeRemaining(GRAFFITI_BOX[i].deadline);
                        if (t.total < 0) continue;
                    }
                    switch (GRAFFITI_BOX[i].type) {
                    case "Default":
                        $("#Graffiti_box_default").append(curCase);
                        break;
                    case "Workshop":
                        $("#Graffiti_box_workshop").append(curCase);
                        break;
                    }
                }
                
                var freeCaseTime = parseInt(getStatistic('free-case-timeout', 0));
                var freeCase = "<div class='case disabled' data-case-id='free' data-souvenir='false'><span class='countdown' data-deadline='" + freeCaseTime + "'></span><img class='case-card' src='../images/Cases/casecard2.png'><img class='case-img' src='../images/Cases/case_blank.png'><span class='case-price currency dollar'>0.00</span><span class='case-name'>FREE</span></div>";
                $('#Default h1').after(freeCase)
                if ($('.countdown').length != 0) {
                    var clockInterval = setInterval(function () {
                        if ($('.countdown').length === 0) {
                            clearInterval(clockInterval);
                        }
                        $('.countdown').each(function () {
                            var deadline = $(this).data('deadline');
                            var t = getTimeRemaining(deadline);
                            var isFree = $(this).parent('.case').data('case-id') === 'free'
                            if (t.total < 0 && !isFree) {
                                $(this).parent('.case').remove();
                            }
                            else if (t.total < 0 && isFree) {
                                $(this).parent('.case').removeClass('disabled');
                                $(this).remove();
                                return;
                            }
                            if (t.days == 0 && !$(this).hasClass('lastDay') && !isFree) $(this).addClass('lastDay');
                            $(this).text(t.days + ':' + t.hours + ':' + t.minutes + ':' + t.seconds);
                        })
                    }, 1000)
                }
                $(document).on('localizationloaded', function () {
                    if (isAndroid()) {
                        var version = client.getCurrentAppVersionCode();
                        if (parseInt(version) < 14) {
                            $('body').append('<div class="new-version"><b>' + Localization.getString('other.new_version.new_version') + '</b><span class="new-version__button" id="new-version__later">' + Localization.getString('other.new_version.later') + '</span><span class="new-version__button" id="new-version__update">' + Localization.getString('other.new_version.update') + '</span></div>');
                        }
                    }
                    checkReward();
                    var $prices = $('.case-price');
                    $prices.each(function () {
                        var casePrice = parseFloat($(this).text()) * 100;
                        var $parent = $(this).parent('.case');
                        if (Player.doubleBalance >= casePrice && $parent.hasClass('disabled') && $parent.data('case-id') !== 'free') {
                            $parent.removeClass('disabled');
                        }
                    })
                    
                    if ($('.news')[0].scrollHeight >  $('.news').innerHeight()) {
                        $('.news').append('<div class="news-overflow">↓ ↓ ↓</div>');
                        $('.news').addClass('news-closed');
                    }
                })
                
                $(document).on('click', '.news-overflow', function() {
                    $('.news').toggleClass('news-opened news-closed');
                    if ($('.news').hasClass('news-opened')) {
                        $('.news-overflow').text('↑ ↑ ↑');
                        $('.news').css({ 'max-height': $('.news')[0].scrollHeight });
                    } else {
                        $('.news-overflow').text('↓ ↓ ↓');
                        $('.news').removeAttr('style');
                    }
                })
                
                if (getURLParameter('start') && isAndroid() && client.getCurrentAppVersionCode() >= 12) {
                    firebase.auth().onAuthStateChanged(function (user) {
                        if (user) {
                            firebase.database().ref('users/' + user.uid + '/private/firebaseToken').set(client.getFirebaseID());
                            LOG.log('Set firebaseToken');
                            
                            firebase.database().ref('users/' + user.uid + '/moder/group').once('value')
                            .then(function(group) {
                                if(group.val() != null && group.val().match(/vip/)) {
                                    client.hideAd();
                                }
                            })
                        }
                    })
                }
                
                new SkinsCarusel({idFrom: 864, idTo: 891, style: "margin: auto;" }).carusel().appendTo('#knives');

                function getTimeRemaining(endtime) {
                    if (typeof endtime === 'number') {
                        var t = new Date(endtime) - Date.now();
                    }
                    else {
                        var t = Date.parse(endtime) - Date.parse(new Date());
                    }
                    var seconds = Math.floor((t / 1000) % 60);
                    var minutes = Math.floor((t / 1000 / 60) % 60);
                    var hours = Math.floor((t / (1000 * 60 * 60)) % 24);
                    var days = Math.floor(t / (1000 * 60 * 60 * 24));
                    return {
                        'total': t
                        , 'days': days
                        , 'hours': hours
                        , 'minutes': minutes
                        , 'seconds': seconds
                    };
                }

                function checkReward() {
                    var lastReward = getStatistic('lastPointReward', 0);
                    var now = new Date();
                    if (lastReward == 0) lastReward = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 1);
                    else lastReward = new Date(lastReward);
                    var today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                    if (lastReward < today) { // 24*60*60*1000
                        console.log(lastReward);
                        console.log(today);
                        // вчера или раньше
                        Level.addEXP(DAILY_REWARD_POINTS);
                        Player.doubleBalance += Level.doubleBonus();
                        var msg = Localization.getString('other.daily_reward.message', 'You get daily reward!<br>+${1} EXP | +${2} double points.');
                        msg = msg.replace('${1}', DAILY_REWARD_POINTS);
                        msg = msg.replace('${2}', Level.doubleBonus());
                        Lobibox.notify('info', {
                            pauseDelayOnHover: false
                            , continueDelayOnInactiveTab: false
                            , width: $(window).width()
                            , position: 'top center'
                            , icon: false
                            , title: Localization.getString('other.daily_reward.title', 'Reward!')
                            , size: 'mini'
                            , showClass: 'fadeInDown'
                            , hideClass: 'fadeOutUp'
                            , msg: msg
                        });
                        saveStatistic('lastPointReward', '' + today);
                        saveStatistic('doubleBalance', Player.doubleBalance);
                        $(document).trigger('doublechanged');
                        $(document).trigger('expchanged');
                    }
                }
                $(document).on('click', '.case, .capsule, .graffiti_box', function () {
                    if ($(this).hasClass('disabled')) return false;
                    if ($(this).data('case-id') === 'free') {
                        var caseId = parseInt(getStatistic('free-case-opening', -1));
                        while (caseId == -1 && (typeof cases[caseId] === 'undefined' || typeof cases[caseId].show === 'undefined' || !cases[caseId].show)) {
                            caseId = Math.rand(0, cases.length);
                            if (cases[caseId].minLvl || cases[caseId].casesToOpen) caseId = -1;
                        }
                        saveStatistic('free-case-opening', caseId);
                        openCase.goToCase(caseId, false)
                        return;
                    }
                    if ($(this).hasClass('case')) openCase.goToCase($(this).data('case-id'), $(this).data('souvenir'))
                    else if ($(this).hasClass('capsule')) openCase.goToCapsule($(this).data('case-id'))
                    else if ($(this).hasClass('graffiti_box')) openCase.goToGraffiti($(this).data('case-id'))
                })
                
                // ==== Load last news ====
                $('.news .container').text('');
                for (var i = 0; i < SHOW_LAST_NEWS; i++) {
                    var day = news[news.length - i - 1];
                    var update = day.update[Settings.language] || day.update.EN;
                    $('.news .container').append('<p>' + update + '</p>');
                }
            });
            $(document).on('click', '#new-version__update', function () {
                location = 'https://play.google.com/store/apps/details?id=csgo.opencase';
            });
            $(document).on('click', '#new-version__later', function () {
                $('.new-version').css('display', 'none');
            });
            $('#showVideoAd').on('click', function () {
                if (isAndroid()) client.showVideoAd("open.html?caseId=" + $('.js-secretField').text() + '&fromAd=1');
                else {
                    //window.location = "open.html?caseId=" + $('.js-secretField').text() + '&fromAd=1';
                }
            });
        </script>
    </div>
</body>

</html>